<div id='<%= tabNode %>' class='tab-content'>
    <div class='tab-body'>
        {{message}}
    </div>
    <div class="tab-head">
        <!-- <button ng-click='unloadModule()'>Close</button> -->
    </div>

    <script type="text/javascript">
        registerModule('<%= tabModule %>', function (module) {
            module.instanceCount = 0;
            module.appFactory = function(app) {
                var appId = app.name;
                var tabId = appId;
                var appNodeId = '#tabNode_<%= tabName %>_' + tabId;
                app.templateName = '<%= tabName %>-template';
                app.ready = function () {
                    // debugger;
                    // var tabNode = $('#<%=tabNode%>');
                    // var $injector = angular.injector(['ng', 'tabsApp']);
                    // var tabViewModelBuilder = $injector.get('tabViewModelBuilder');
                    // tabViewModelBuilder.buildDynamicScope(app, tabNode,
                    //     function (injector, scope) {
                    //         // debugger;
                    //         scope.message = 'Hello there !!!';
                    //         scope.unloadModule = function () {
                    //             setTimeout(function () {
                    //                 // debugger;
                    //                 module.dispose(tabId);
                    //             }, 0);
                    //         };
                    //     });
                    corelib.log('tabs', 'tab ' + tabId + ' loaded');
                };
                var sub1 = corelib.messageHub().subscribe('tab-close', function (msg) {
                    var appNode = $(appNodeId);
                    app.cleanup(appNode);
                    app = null;
                    appNode = null;
                });
                app.dispose = function () {
                    corelib.messageHub().unsubscribe(sub1);
                    corelib.log('tabs', 'tab ' + appId + ' disposed');
                };

            };
        })
        .runApp('<%= tabId %>');
    </script>
</div>
