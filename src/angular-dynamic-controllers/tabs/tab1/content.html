<div id='<%=tabNode%>' class='tab-content'>
    <div class='tab-body'>
        {{message}}
    </div>
    <div class="tab-head">
        <button ng-click='unloadModule()'>Close</button>
    </div>

    <script type="text/javascript">
        registerModule('<%=tabModule%>', function (module) {
            module.instanceCount = 0;
            module.ready = function (appId) {
                var appInstance = module.registerApp(appId, { instanceId: ++ module.instanceCount },
                    function (app) {
                    app.ready = function () {
                        // debugger;
                        var tabNode=$('#<%=tabNode%>');
                        var $injector = angular.injector(['ng', 'tabsApp']);
                        var tabViewModelBuilder = $injector.get('tabViewModelBuilder');
                        var tabId = appId;
                        tabViewModelBuilder.buildDynamicScope(app, tabNode, 
                            function(injector, scope) {
                                // debugger;
                                scope.message = 'Hello there !!!';
                                scope.unloadModule = function() {
                                    setTimeout(function( ){
                                        // debugger;
                                        module.dispose(tabId);
                                    }, 0);
                                };
                        });
                    };
                    app.dispose = function () { };
                });
                appInstance.ready();
            };
            module.dispose = function (appId) {
                var element = $('#<%=tabNode%>');
                if (appId && module.apps[appId]) {
                    module.apps[appId].angularTabCleanup(element);
                } else {
                    module.destruct();
                    element.empty();
                    element.remove();
                }
            };
        }).ready('<%= tabId %>');
    </script>    
</div>

